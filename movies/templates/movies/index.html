{% extends 'base.html' %}

{% block content %}
    <h1>MOVIE</h1>
    <div id="app">
        <button @click="boxOffice">현재 상영작</button>
        <p v-for="movie in movies" v-html="movie.title">{{ movie.title }}</p>
        <div v-if="getVideoUrl" class="embed-responsive embed-responsive-16by9">
            <iframe class="embed-responsive-item"
              :src="videoUrl"
              allowfullscreen>
            </iframe>
        </div>
    </div>

    

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>
        const API_KEY = 'AIzaSyA3AI1maKoEbHFJ189Qeww-AzfeZR4PC-g'
        const API_URL = 'https://www.googleapis.com/youtube/v3/search'

        const app = new Vue({
            el: '#app',
            data: {
                movies: Array,
                movieTrailier: null,
                firstMovie: null,
                videoUrl: null,
            },
            methods: {
                boxOffice() {
                    console.log('--1')
                    axios.get('https://api.themoviedb.org/3/movie/now_playing?api_key=f13f39298b386f7fec21be0041fc1451&language=ko-KR&page=1&region=kr')
                        .then(response => {
                            console.log(response.data['results'][0].title)
                            this.movies = response.data["results"]
                            this.firstMovie = response.data['results'][0].original_title
                            axios.get(API_URL, {
                                params: {
                                key: API_KEY,
                                part: 'snippet',
                                type: 'video',
                                q: this.firstMovie
                                }
                            })
                                .then(response => {
                                    console.log(response.data.items[0].id.videoId)
                                    this.videoUrl = `https://www.youtube.com/embed/${response.data.items[0].id.videoId}`
                                })
                                .catch(error => {
                                    console.log(error)
                                })
                        })
                },
                // trailerPlay(videoValue) {
                //     console.log('--2')
                //     console.log('first', this.firstMovie)
                //     console.log(videoValue)
                //     axios.get(API_URL, {
                //         params: {
                //         key: API_KEY,
                //         part: 'snippet',
                //         type: 'video',
                //         q: videoValue
                //         }
                //     })
                //         .then(response => {
                //             console.log(response.data.items[0].id.videoId)
                //             this.videoUrl = `https://www.youtube.com/embed/${response.data.items[0].id.videoId}`
                //             console.log(this.firstMovie, this.videoUrl)
                //             console.log('2')

                //         })
                //         .catch(error => {
                //             console.log(error)
                //         })
                // }
            },
            computed: {
                getVideoUrl() {
                    return this.videoUrl
                }
            },
            mounted() {
                this.boxOffice()
                console.log(this.firstMovie)
                // this.trailerPlay(this.firstMovie)
            }
        })
    </script>
{% endblock %}
